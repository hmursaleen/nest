{% extends 'base.html' %}

{% block title %}
    {{ post.title }} - Blog Post
{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row">
        <div class="col-md-12">
            <div class="post-header mb-4">
                <h1>{{ post.title }}</h1>
                <p class="text-muted">
                    Posted by 
                    <strong>{{ post.author }}</strong> 
                    on 
                    {{ post.published_at|date:"F j, Y, g:i a" }}
                    {% if post.updated_at > post.published_at %}
                        (Updated on {{ post.updated_at|date:"F j, Y, g:i a" }})
                    {% endif %}
                </p>
                <hr>
            </div>

            <div class="post-content mb-4">
                {{ post.content|safe }}
            </div>

            <div class="post-tags mb-4">
                {% if post.tags.exists %}
                    <p><strong>Tags:</strong>
                    {% for tag in post.tags.all %}
                        <a href="{{ tag.get_absolute_url }}" class="badge bg-secondary text-light">{{ tag.name }}</a>
                    {% endfor %}
                    </p>
                {% endif %}
            </div>

            <div class="post-footer">
                <a href="{% url 'blogs:post_list' %}" class="btn btn-primary">Back to Blog List</a>

                {% if request.user == post.author %}
                    <a href="{% url 'blogs:post_update' slug=post.slug %}" class="btn btn-warning">Edit Post</a>
                    <a href="{% url 'blogs:post_delete' slug=post.slug %}" class="btn btn-danger">Delete Post</a>
                {% endif %}
            </div>


            <div class="comments-section">
                <h4>Comments</h4>
                {% for comment in post.comments.all %}
                    <div class="comment">
                        <strong>{{ comment.author }}</strong>
                        <p>{{ comment.content }}</p>
                        <a href="{% url 'comments:comment_create' post.slug %}?parent_id={{ comment.id }}" class="btn btn-link">Reply</a>
                        <!-- Display replies -->
                        {% if comment.children.exists %}
                            <div class="replies ml-4">
                                {% for reply in comment.children.all %}
                                    <div class="comment">
                                        <strong>{{ reply.author }}</strong>
                                        <p>{{ reply.content }}</p>
                                    </div>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                {% empty %}
                    <p>No comments yet.</p>
                {% endfor %}
            </div>
             {% include 'comments/comment_form.html' %}

        </div>
    </div>
</div>
{% endblock %}
